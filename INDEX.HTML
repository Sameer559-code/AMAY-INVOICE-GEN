<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Quotation & Invoice Generator</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h1 { color: #003399; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    table, th, td { border: 1px solid #ccc; }
    th, td { padding: 8px; text-align: left; }
    .totals { margin-top: 15px; text-align: right; }
    .buttons { margin-top: 20px; }
    input[type="text"], input[type="number"], input[type="date"] {
      width: 100%; padding: 5px;
    }
    textarea { width: 100%; padding: 5px; }
    .desc { width: 100%; }
    .remove-btn { color: red; cursor: pointer; font-weight: bold; }
  </style>
</head>
<body>

  <h1>Quotation & Invoice Generator</h1>

  <!-- Header -->
  <label>Company Name:</label>
  <input type="text" id="companyName" value="Al Fas Construction & Fabrication"><br><br>

  <label>Company Address:</label>
  <textarea id="companyAddress">Sajaya 7, B Block, Office 134, Nad Al Sheba 3, Dubai</textarea><br><br>

  <label>Title:</label>
  <input type="text" id="invoiceTitle" value="Quotation / Invoice"><br><br>

  <label>Invoice No:</label>
  <input type="text" id="invoiceNumber" value="AFCF/SEP/2025/001"><br><br>

  <label>Date:</label>
  <input type="date" id="invoiceDate"><br><br>

  <!-- Client -->
  <h3>Client Details (Optional)</h3>
  <label>Company Name:</label>
  <input type="text" id="clientCompany"><br><br>
  <label>Contact Person:</label>
  <input type="text" id="clientContact"><br><br>
  <label>Address:</label>
  <textarea id="clientAddress"></textarea><br><br>

  <!-- Items -->
  <h3>Items / Services</h3>
  <table id="itemsTable">
    <thead>
      <tr>
        <th>Sl No</th>
        <th>Description</th>
        <th>Qty</th>
        <th>Price (AED)</th>
        <th>Amount (AED)</th>
        <th>Remove</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>1</td>
        <td><input type="text" class="desc" value="S/S Upright Single Door Chiller â€“ Capacity, Temp, Power"></td>
        <td><input type="number" class="qty" value="1" min="1"></td>
        <td><input type="number" class="price" value="2500" step="0.01"></td>
        <td class="amount">2500.00 AED</td>
        <td><span class="remove-btn" onclick="removeRow(this)">X</span></td>
      </tr>
    </tbody>
  </table>
  <button onclick="addRow()">Add Row</button>

  <!-- Totals -->
  <div class="totals">
    <p>Subtotal: <span id="subtotal">2500.00</span> AED</p>
    <p>Discount (%): <input type="number" id="discount" value="0" oninput="calculateTotals()"> </p>
    <p>VAT (%): <input type="number" id="vat" value="5" oninput="calculateTotals()"> </p>
    <p><strong>Grand Total: <span id="grandTotal">2625.00</span> AED</strong></p>
  </div>

  <!-- Export Buttons -->
  <div class="buttons">
    <button onclick="exportPDF()">Export as PDF</button>
  </div>

  <!-- jsPDF & AutoTable -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.0/jspdf.plugin.autotable.min.js"></script>

  <script>
    function addRow() {
      const table = document.getElementById("itemsTable").getElementsByTagName('tbody')[0];
      const rowCount = table.rows.length + 1;
      const row = table.insertRow();

      row.innerHTML = `
        <td>${rowCount}</td>
        <td><input type="text" class="desc"></td>
        <td><input type="number" class="qty" value="1" min="1"></td>
        <td><input type="number" class="price" value="0" step="0.01"></td>
        <td class="amount">0.00 AED</td>
        <td><span class="remove-btn" onclick="removeRow(this)">X</span></td>
      `;
      calculateTotals();
    }

    function removeRow(btn) {
      const row = btn.closest("tr");
      row.remove();
      updateSerialNumbers();
      calculateTotals();
    }

    function updateSerialNumbers() {
      const rows = document.querySelectorAll("#itemsTable tbody tr");
      rows.forEach((row, index) => {
        row.cells[0].innerText = index + 1;
      });
    }

    function calculateTotals() {
      let subtotal = 0;
      document.querySelectorAll("#itemsTable tbody tr").forEach((row) => {
        const qty = parseFloat(row.querySelector(".qty").value) || 0;
        const price = parseFloat(row.querySelector(".price").value) || 0;
        const amount = qty * price;
        row.querySelector(".amount").innerText = amount.toFixed(2) + " AED";
        subtotal += amount;
      });

      document.getElementById("subtotal").innerText = subtotal.toFixed(2);

      const discount = parseFloat(document.getElementById("discount").value) || 0;
      const vat = parseFloat(document.getElementById("vat").value) || 0;

      let discounted = subtotal - (subtotal * (discount / 100));
      let total = discounted + (discounted * (vat / 100));

      document.getElementById("grandTotal").innerText = total.toFixed(2);
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();

      // Header
      const companyName = document.getElementById("companyName").value || "Al Fas Construction & Fabrication";
      const address = document.getElementById("companyAddress").value || "Sajaya 7, B Block, Office 134, Nad Al Sheba 3, Dubai";
      const invoiceTitle = document.getElementById("invoiceTitle").value || "Quotation / Invoice";
      const invoiceNumber = document.getElementById("invoiceNumber").value;
      const date = document.getElementById("invoiceDate").value;

      doc.setFontSize(18);
      doc.setTextColor(0, 51, 153);
      doc.text(companyName, 105, 20, { align: "center" });

      doc.setFontSize(10);
      doc.setTextColor(0, 0, 0);
      doc.text(address, 105, 27, { align: "center" });

      doc.setFontSize(14);
      doc.text(invoiceTitle, 14, 40);

      doc.setFontSize(10);
      doc.text("Invoice No: " + invoiceNumber, 14, 48);
      doc.text("Date: " + date, 14, 54);

      // Client
      const clientName = document.getElementById("clientCompany").value;
      const contactPerson = document.getElementById("clientContact").value;
      const clientAddress = document.getElementById("clientAddress").value;

      let y = 65;
      if (clientName) {
        doc.text("Bill To:", 14, y);
        y += 6;
        doc.text(clientName, 14, y); y += 6;
        if (contactPerson) { doc.text("Attn: " + contactPerson, 14, y); y += 6; }
        if (clientAddress) { doc.text(clientAddress, 14, y); y += 6; }
      }

      // Items
      const tableData = [];
      document.querySelectorAll("#itemsTable tbody tr").forEach((row, index) => {
        const desc = row.querySelector(".desc").value;
        const qty = row.querySelector(".qty").value;
        const price = row.querySelector(".price").value;
        const amount = (qty * price).toFixed(2);
        if (desc.trim() !== "") {
          tableData.push([index + 1, desc, qty, price + " AED", amount + " AED"]);
        }
      });

      doc.autoTable({
        startY: y + 10,
        head: [['Sl No', 'Description', 'Qty', 'Price (AED)', 'Amount (AED)']],
        body: tableData,
        theme: 'grid',
        styles: { fontSize: 9, cellPadding: 3 },
        headStyles: { fillColor: [0, 51, 153], textColor: 255 },
        columnStyles: {
          0: { cellWidth: 15 },
          1: { cellWidth: 80 },
          2: { cellWidth: 20, halign: 'right' },
          3: { cellWidth: 30, halign: 'right' },
          4: { cellWidth: 30, halign: 'right' },
        }
      });

      let finalY = doc.lastAutoTable.finalY + 10;

      // Totals
      const subtotal = document.getElementById("subtotal").innerText;
      const discount = document.getElementById("discount").value || 0;
      const vat = document.getElementById("vat").value || 0;
      const grandTotal = document.getElementById("grandTotal").innerText;

      doc.text("Subtotal: " + subtotal + " AED", 140, finalY); finalY += 6;
      doc.text("Discount: " + discount + "%", 140, finalY); finalY += 6;
      doc.text("VAT: " + vat + "%", 140, finalY); finalY += 6;
      doc.setFontSize(12);
      doc.setFont(undefined, "bold");
      doc.text("Grand Total: " + grandTotal + " AED", 140, finalY);

      finalY += 20;

      // Footer
      doc.setFontSize(10);
      doc.setFont(undefined, "normal");
      doc.text("Authorized Signatory: ___________________", 14, finalY); finalY += 15;
      doc.text("Nauwshad Ghalid | +971 50 858 26505 | WhatsApp: +971 55 694 0889", 14, finalY);

      finalY += 15;
      doc.setFontSize(12);
      doc.setTextColor(0, 51, 153);
      doc.text("Thank You for your business!", 105, finalY, { align: "center" });

      doc.save("Quotation_Invoice.pdf");
    }

    // Auto recalc on change
    document.addEventListener("input", calculateTotals);
    calculateTotals();
  </script>
</body>
</html>
